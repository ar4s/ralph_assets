{% extends 'assets/add_assets.html' %}
{% load assets %}
{% load bob %}
{% load i18n %}

{% block form_title %}{% trans "Edit device" %}{% endblock %}

{% block additional_inputs %}
  {% for field in additional_info %}
    {% field_wrapper field %}
  {% endfor %}
{% endblock %}

{% block tabular_info %}
{% include 'assets/attachment_table.html' with attachment_parent=asset parent_name='asset'%}
  <div>
    <h6><a href="{{ history_link }}">{% trans "Full history" %}</a></h6>
  </div>
  {% if status_history %}
      <div>
          <h5>{% trans "Status history" %}</h5>
          <table class="table table-striped table-bordered details-history">
              <thead><tr>
                  <th>{% trans "Date" %}</th>
                  <th>{% trans "Author" %}</th>
                  <th>{% trans "Before" %}</th>
                  <th>{% trans "After" %}</th>
              </tr></thead>
              <tbody>
              {% for h in status_history %}
                  <tr>
                      <td>{{ h.date|timesince_limited }}</td>
                      <td>{{ h.user|default:'' }}</td>
                      <td>{{ h.old_value }}</td>
                      <td>{{ h.new_value }}</td>
                  </tr>
              {% endfor %}
              </tbody>
          </table>
      </div>
  {% endif %}
  {% transition_history asset %}
{% endblock %}

{% block parts %}
  <div>
    <h5>{% trans "Device parts" %}</h5>
    {% if parts %}
    <table class="table table-striped table-bordered details-history">
        <thead><tr>
            <th></th>
            <th>{% trans "Name" %}</th>
            <th>{% trans "Source device" %}</th>
            <th>{% trans "Author" %}</th>
        </tr></thead>
        <tbody>
        {% for part in parts%}
            <tr>
                <td><input type="checkbox" name="part_ids" value="{{ part.id }}"></td>
                <td><a href="{% url part_edit mode=mode asset_id=part.id %}">{{ part }}</a></td>
                <td><a href="{% if part.part_info.source_device %}{% url device_edit mode=mode asset_id=part.part_info.source_device.id %}{% endif %}">{{ part.part_info.source_device|default:'-'}}</a></td>
                <td>{{ part.user|default:'-'}}</td>
            </tr>
        {% endfor %}
        </tbody>
    </table>
    <div class="pull-left">
      <div class="pull-left">
      {% for field in part_form %}
          {{ field.label }}: {{ field }}
      {% endfor %}
      </div>
      <button class="btn btn-primary pull-left" name="move_parts" type="submit">{% trans "Move part" %}</button>
    </div>
    {% endif %}
    {% if not asset.has_parts %}
      {% spaceless %}
      <div class="pull-left">
        <a href="{% url device_split mode='dc' asset_id=asset.id %}" class="btn btn-danger">
          <i class="fugue-icon fugue-cutter"></i>&nbsp;{% trans "Split device" %}
        </a>
      </div>
      {% endspaceless %}
    {% endif %}
    <div class="pull-right">
      <a href="{% url add_part mode=mode  %}?device={{asset.id}}" class="btn btn-primary">{% trans "Add part" %}</a>
    </div>
  </div>
{% endblock %}

{% block multi_widget %}


<div class="well">

        <h6> Assign Licence </h6>
        {# {% multi_assign_widget xxx_form %} #}


<form method="POST" class="form form-inline form-split">
  {% csrf_token %}
  {{ xxx_formset.management_form }}
  <div class="row overflow-x">
    <table class="table table-striped table-bordered table-condensed">
      <thead><tr>
        <th></th>
        <th>Remove</th>
        <th>Asset</th>
        <th>Assigned count</th>
      </tr></thead>
      <tbody>
       {% for form in xxx_formset %}
          <tr>
            <td style="vertical-align:middle" class="ordinal" data-no="{{ forloop.counter }}">
              {{ forloop.counter }}
            </td>
            {% for field in form %}
              <td class="control-group{% if "-support_period" in field.html_name %} small{% endif %}{% if field.errors %} error{% endif %}" style="vertical-align:middle">
                {{ field }}
                {% if field.errors %}
                  <span class="help-inline">{% for error in field.errors %}{{ error }} {% endfor %}</span>
                {% endif %}
              </td>
            {% endfor %}
          </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
  <div class="row" style="margin-top:10px;">
    <a href="#" class="btn btn-success add_row" data-ajax-fetch-url="http://127.0.0.1:8080/assets/ajax-view/multi-form-row/">+</a>
  </div>
  <div class="row">
    <div class="form-actions">
      <button type="submit" class="btn btn-primary">Save</button>
    </div>
  </div>
</form>


</div>
{% endblock %}
